<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Frida基础 | Zyb'Blog</title><meta name="author" content="Nohup"><meta name="copyright" content="Nohup"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="# Frida 基础  虚拟环境安装给 frida一个纯净的 Python 环境 conda 创建虚拟环境1conda create -n frida python&#x3D;3.8   进入虚拟环境1conda activate frida  退出虚拟环境1conda deactivate  删除虚拟环境1conda remove --name frida --all  Fridagithub 地址：">
<meta property="og:type" content="article">
<meta property="og:title" content="Frida基础">
<meta property="og:url" content="http://qwd.ai/2023/06/21/Frida%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="Zyb&#39;Blog">
<meta property="og:description" content="# Frida 基础  虚拟环境安装给 frida一个纯净的 Python 环境 conda 创建虚拟环境1conda create -n frida python&#x3D;3.8   进入虚拟环境1conda activate frida  退出虚拟环境1conda deactivate  删除虚拟环境1conda remove --name frida --all  Fridagithub 地址：">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://qwd.ai/img/self.png">
<meta property="article:published_time" content="2023-06-21T10:12:09.000Z">
<meta property="article:modified_time" content="2023-06-21T10:12:09.000Z">
<meta property="article:author" content="Nohup">
<meta property="article:tag" content="Fida">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://qwd.ai/img/self.png"><link rel="shortcut icon" href="/img/bk.png"><link rel="canonical" href="http://qwd.ai/2023/06/21/Frida%E5%9F%BA%E7%A1%80/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: {"limitDay":200,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Frida基础',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-21 18:12:09'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Zyb'Blog" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/xlenco/JS-X@main/pace.js/pace.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/self.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 图库</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tuku/"><i class="fa-fw fas fa-heart"></i><span> 其他</span></a></li><li><a class="site-page child" href="/girls/"><i class="fa-fw fas fa-heart"></i><span> 美女</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/bj.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Zyb'Blog"><img class="site-icon" src="/img/bk.png"/><span class="site-name">Zyb'Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 图库</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tuku/"><i class="fa-fw fas fa-heart"></i><span> 其他</span></a></li><li><a class="site-page child" href="/girls/"><i class="fa-fw fas fa-heart"></i><span> 美女</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Frida基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-06-21T10:12:09.000Z" title="发表于 2023-06-21 18:12:09">2023-06-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-21T10:12:09.000Z" title="更新于 2023-06-21 18:12:09">2023-06-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Frida基础"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><meta name="referrer" content="no-referrer"/>
# Frida 基础

<h2 id="虚拟环境安装"><a href="#虚拟环境安装" class="headerlink" title="虚拟环境安装"></a>虚拟环境安装</h2><p>给 frida一个纯净的 Python 环境</p>
<h3 id="conda-创建虚拟环境"><a href="#conda-创建虚拟环境" class="headerlink" title="conda 创建虚拟环境"></a>conda 创建虚拟环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n frida python=3.8 </span><br></pre></td></tr></table></figure>

<h3 id="进入虚拟环境"><a href="#进入虚拟环境" class="headerlink" title="进入虚拟环境"></a>进入虚拟环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda activate frida</span><br></pre></td></tr></table></figure>

<h3 id="退出虚拟环境"><a href="#退出虚拟环境" class="headerlink" title="退出虚拟环境"></a>退出虚拟环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda deactivate</span><br></pre></td></tr></table></figure>

<h3 id="删除虚拟环境"><a href="#删除虚拟环境" class="headerlink" title="删除虚拟环境"></a>删除虚拟环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda remove --name frida --all</span><br></pre></td></tr></table></figure>

<h2 id="Frida"><a href="#Frida" class="headerlink" title="Frida"></a>Frida</h2><p>github 地址： <a target="_blank" rel="noopener" href="https://github.com/frida/frida">frida</a></p>
<p>官方文档 <a target="_blank" rel="noopener" href="https://frida.re/docs/home/">https://frida.re/docs/home/</a></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install frida-tools  <span class="comment"># 会自动帮你下载Frida 最新版</span></span><br></pre></td></tr></table></figure>

<h4 id="安装指定版本"><a href="#安装指定版本" class="headerlink" title="安装指定版本"></a>安装指定版本</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install frida==版本号</span><br></pre></td></tr></table></figure>

<p>因为 一个 frida-tools 会对应多个 frida 版，所以安装指定版本不能直接安装最新版，需查看对应版本号</p>
<p>访问 <a target="_blank" rel="noopener" href="https://github.com/frida/frida/releases/tag/">https://github.com/frida/frida/releases/tag/</a> + frida 版本号，找到 python3-frida-tools-版本号，即 frida-tools 版本号</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install frida-tools==版本号</span><br></pre></td></tr></table></figure>

<h4 id="查看版本号，验证是否安装成功"><a href="#查看版本号，验证是否安装成功" class="headerlink" title="查看版本号，验证是否安装成功"></a>查看版本号，验证是否安装成功</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida --v</span><br></pre></td></tr></table></figure>

<h4 id="frida-代码提示"><a href="#frida-代码提示" class="headerlink" title="frida 代码提示"></a>frida 代码提示</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @types/frida-gum</span><br></pre></td></tr></table></figure>

<h3 id="frida-版本与-Android-版本与-Python-版本"><a href="#frida-版本与-Android-版本与-Python-版本" class="headerlink" title="frida 版本与 Android 版本与 Python 版本"></a>frida 版本与 Android 版本与 Python 版本</h3><table>
<thead>
<tr>
<th>frida</th>
<th>Android</th>
<th>Python</th>
</tr>
</thead>
<tbody><tr>
<td>12.3.6</td>
<td>5-6</td>
<td>3.7</td>
</tr>
<tr>
<td>12.8.0</td>
<td>7-8</td>
<td>3.8</td>
</tr>
<tr>
<td>14+</td>
<td>9+</td>
<td>3.8</td>
</tr>
</tbody></table>
<h3 id="fridaserver"><a href="#fridaserver" class="headerlink" title="fridaserver"></a>fridaserver</h3><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><p>fridaserver 与 frida 版本需要匹配，和 frida-tools 一样，访问 <a target="_blank" rel="noopener" href="https://github.com/frida/frida/releases/tag/">https://github.com/frida/frida/releases/tag/</a> + frida 版本号，可以找到对应的 fridaserver 版本。</p>
<p>文件名的格式为：<code>frida-server-(version)-(platform)-(cpu).xz</code>，需要下载的安卓的也就是<code>frida-server-15.1.14-android-arm64.xz</code>， <strong>解压后</strong>将文件 push 到手机内<code>/data/local/tmp/</code>下，并重命名 fsarm64</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">adb push C:\Users\kuizuo\Desktop\frida-server-15.1.14-android-arm64 /data/local/tmp/fsarm64</span><br><span class="line"></span><br><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line"><span class="built_in">cd</span> data/local/tmp</span><br><span class="line"><span class="built_in">chmod</span> 777 fsarm64</span><br><span class="line"></span><br><span class="line">./fsarm64</span><br></pre></td></tr></table></figure>

<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMD 手机端</span></span><br><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line">./data/local/tmp/fsarm64 <span class="comment"># 启动fs服务</span></span><br><span class="line"><span class="comment"># 可添加参数 -l 0.0.0.0:9000 指定端口为9000(默认27042),用于frida -H连接多个设备</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CMD 电脑端</span></span><br><span class="line">conda activate frida <span class="comment">#进入frida环境</span></span><br><span class="line">frida -H -U -l hook.js</span><br></pre></td></tr></table></figure>

<p><strong>新版本 fridaserver 无需端口转发</strong>，旧版可能还需要新开一个 CMD 窗口执行<code>adb forward tcp:27042 tcp:27042</code></p>
<h2 id="Frida-命令"><a href="#Frida-命令" class="headerlink" title="Frida 命令"></a>Frida 命令</h2><p>Hook 前提: 在 hook 时，要保证参数类型执行流程与原代码保持一致，必要的调用与结果返回不可省略，否则将有可能导致程序崩溃。</p>
<p><code>frida -help</code> 查看帮助，常用选项如下</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>-U,–usb</td>
<td>连接 USB 设备</td>
</tr>
<tr>
<td>-F, –attach-frontmost</td>
<td>app 最前显示的应用</td>
</tr>
<tr>
<td>-H HOST, –host&#x3D;HOST</td>
<td>通过端口连接 frida-server 默认监听 局域网 ip:27042</td>
</tr>
<tr>
<td>-f FILE, –file&#x3D;FILE spawn FILE</td>
<td>以包名方式，自动启动 app 用%resume 恢复主线程</td>
</tr>
<tr>
<td>-l SCRIPT, –load&#x3D;SCRIPT</td>
<td>以 js 脚本方式注入</td>
</tr>
<tr>
<td>-n NAME, –attach-name&#x3D;NAME</td>
<td>以包名附加</td>
</tr>
<tr>
<td>-p PID, –attach-pid&#x3D;PID</td>
<td>以 PID 附加</td>
</tr>
<tr>
<td>-o LOGFILE, –output&#x3D;LOGFILE</td>
<td>将结果输出到文件上</td>
</tr>
<tr>
<td>–debug</td>
<td>附加到 Node.js 进行调试</td>
</tr>
<tr>
<td>–no-pause</td>
<td>启动后，自动运行主线程 可省略%resume</td>
</tr>
</tbody></table>
<h3 id="简单-Hook-脚本演示"><a href="#简单-Hook-脚本演示" class="headerlink" title="简单 Hook 脚本演示"></a>简单 Hook 脚本演示</h3><p><strong>注：Frida 老版本不支持 es6 语法。</strong></p>
<p>代码如下</p>
<figure class="highlight js"><figcaption><span>title</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// java层的代码 都需要在perform下执行</span></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// Java.use()   // 选择对应的类名 返回实例化的对象  可直接调用类下方法(反编译后查看)</span></span><br><span class="line">  <span class="keyword">var</span> <span class="title class_">Util</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;com.dodonew.online.util.Utils&#x27;</span>)</span><br><span class="line">  <span class="comment">// 调用类下的md5方法 同时实现方法改为新函数</span></span><br><span class="line">  <span class="title class_">Util</span>.<span class="property">md5</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a: &#x27;</span>, a)</span><br><span class="line">    <span class="keyword">var</span> ret = <span class="variable language_">this</span>.<span class="title function_">md5</span>(a)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ret: &#x27;</span>, ret)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>运行 <code>frida -U -F -l hook.js</code>，触发 hook 的函数，便可打印出参。</p>
<h3 id="获取类"><a href="#获取类" class="headerlink" title="获取类"></a>获取类</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java.use(类名)</span></span><br><span class="line"><span class="keyword">let</span> J_String = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.String&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">HashMap</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.util.HashMap&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Utils</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;com.kuizuo.app.Utils&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="静态方法与实例方法"><a href="#静态方法与实例方法" class="headerlink" title="静态方法与实例方法"></a>静态方法与实例方法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">类.方法.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.方法()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果有返回值则需要将返回值返回</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Util</span>.<span class="property">md5</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a: &#x27;</span>, a)</span><br><span class="line">  <span class="keyword">let</span> ret = <span class="variable language_">this</span>.<span class="title function_">md5</span>(a)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ret: &#x27;</span>, ret)</span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HashMap</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.util.HashMap&#x27;</span>)</span><br><span class="line"><span class="title class_">HashMap</span>.<span class="property">put</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key, value</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">key</span>: key.<span class="title function_">toString</span>(), <span class="attr">value</span>: value.<span class="title function_">toString</span>() &#125;))</span><br><span class="line">  <span class="keyword">let</span> ret = <span class="variable language_">this</span>.<span class="title function_">put</span>(key, value) <span class="comment">// 如果不修改的话，则需要原封不动的传入。</span></span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="重载方法"><a href="#重载方法" class="headerlink" title="重载方法"></a>重载方法</h3><p>如果方法有重载，需要使用<code>.overload(&#39;java.lang.String&#39;)</code> 给定参数个数与类型，如果有重载，但是不使用 overload，frida 将会报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Util</span>.<span class="property">test</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> ret = <span class="variable language_">this</span>.<span class="title function_">test</span>(a)</span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Util</span>.<span class="property">test</span>.<span class="title function_">overload</span>(<span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> ret = <span class="variable language_">this</span>.<span class="title function_">test</span>(a)</span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="hook-所有重载方法"><a href="#hook-所有重载方法" class="headerlink" title="hook 所有重载方法"></a>hook 所有重载方法</h4><p>像上述两个重载方法，就需要编写两份代码，如果重载方法过多，代码不能很好的复用，就可以使用获取类下的所有重载方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">类.方法.<span class="property">overloads</span> <span class="comment">// 返回所有重载方法,依次为每个成员实现implementation方法即可hook多个重载方法</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> overloads = <span class="title class_">RequestUtil</span>.<span class="property">encodeDesMap</span>.<span class="property">overloads</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads) &#123;</span><br><span class="line">  overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(Array.from(arguments));</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>([...<span class="variable language_">arguments</span>])</span><br><span class="line">    <span class="comment">// 两者都是打印参数，将类数组转真实数组</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">encodeDesMap</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">类.<span class="property">$init</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.$init()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实例化对象"><a href="#实例化对象" class="headerlink" title="实例化对象"></a>实例化对象</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">类.$new() <span class="comment">// 等同于 new 类()</span></span><br></pre></td></tr></table></figure>

<h3 id="主动调用类方法"><a href="#主动调用类方法" class="headerlink" title="主动调用类方法"></a>主动调用类方法</h3><p><strong>以下的“类”，是通过<code>Java.use()</code>返回的值。</strong></p>
<h4 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">类.方法()</span><br></pre></td></tr></table></figure>

<h4 id="实例方法-实例化对象"><a href="#实例方法-实例化对象" class="headerlink" title="实例方法 实例化对象"></a>实例方法 实例化对象</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = 类.$new()</span><br><span class="line">obj.方法()</span><br></pre></td></tr></table></figure>

<h4 id="实例方法-获取已有对象-Java-choose"><a href="#实例方法-获取已有对象-Java-choose" class="headerlink" title="实例方法 获取已有对象(Java.choose)"></a>实例方法 获取已有对象(Java.choose)</h4><p>内存中遍历，找到<strong>所有</strong>符合条件的对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&#x27;类路径&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">    obj.方法()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;内存中的对象搜索完毕&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这样调用不优雅，会陷入回调地狱，所以可以封装成一个外部函数，来调用。（留个伏笔 TODO…）</p>
<h3 id="修改函数参数与返回值"><a href="#修改函数参数与返回值" class="headerlink" title="修改函数参数与返回值"></a>修改函数参数与返回值</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Utils</span>.<span class="property">md5</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> b = <span class="string">&#x27;随便设置的参数值&#x27;</span></span><br><span class="line">  <span class="keyword">let</span> result = <span class="variable language_">this</span>.<span class="title function_">md5</span>(b) <span class="comment">// 直接修改成b</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;随便设置的返回值&#x27;</span> <span class="comment">// frida会将字符串包装成java的String对象。</span></span><br><span class="line">  <span class="comment">// return J_String.$new(&quot;随便设置的返回值&quot;);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="获取与修改类字段-成员变量"><a href="#获取与修改类字段-成员变量" class="headerlink" title="获取与修改类字段(成员变量)"></a>获取与修改类字段(成员变量)</h3><h4 id="静态字段"><a href="#静态字段" class="headerlink" title="静态字段"></a>静态字段</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">类.字段.<span class="property">value</span> <span class="comment">// 获取类的属性值</span></span><br><span class="line">类.字段.<span class="property">value</span> = <span class="string">&#x27;新的值&#x27;</span> <span class="comment">// 修改类的值</span></span><br></pre></td></tr></table></figure>

<h4 id="实例字段-实例化对象"><a href="#实例字段-实例化对象" class="headerlink" title="实例字段 实例化对象"></a>实例字段 实例化对象</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = 类.$new()</span><br><span class="line">obj.字段.<span class="property">value</span></span><br></pre></td></tr></table></figure>

<h4 id="实例字段-获取已有对象-Java-choose"><a href="#实例字段-获取已有对象-Java-choose" class="headerlink" title="实例字段 获取已有对象(Java.choose)"></a>实例字段 获取已有对象(Java.choose)</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&#x27;类路径&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.字段.<span class="property">value</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>:::tip</p>
<p><strong>注: 如果字段名与方法名一样，则需要给字段名前加下划线_，否则获取到的是方法</strong></p>
<p>:::</p>
<h3 id="内部类与匿名类"><a href="#内部类与匿名类" class="headerlink" title="内部类与匿名类"></a>内部类与匿名类</h3><p>内部类</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> 外部类$内部类 = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;外部类$内部类&#x27;</span>) <span class="comment">// 变量命名随意</span></span><br><span class="line"><span class="keyword">const</span> 外部类$1 = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;外部类$1&#x27;</span>) <span class="comment">// 获取第一个内部类</span></span><br></pre></td></tr></table></figure>

<p>匿名类</p>
<p>匿名类是根据内存生成，没有具体的内部类名，通过 smali 代码来判断，获取到的可能像下面这样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> $1 = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;包名.MainActivity$1&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="枚举类"><a href="#枚举类" class="headerlink" title="枚举类"></a>枚举类</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;枚举类&quot;</span> &#123;</span><br><span class="line">    <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="title function_">ordinal</span>()); <span class="comment">// 输出枚举的键</span></span><br><span class="line">    &#125;, <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;枚举类&quot;</span>).<span class="title function_">values</span>()); <span class="comment">// 输出值</span></span><br></pre></td></tr></table></figure>

<h3 id="获取所有类"><a href="#获取所有类" class="headerlink" title="获取所有类"></a>获取所有类</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClassesSync</span>() <span class="comment">// 同步获取已加载所有类,返回一个数组</span></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClasses</span>() <span class="comment">// 异步</span></span><br></pre></td></tr></table></figure>

<h4 id="加载类下所有方法，属性"><a href="#加载类下所有方法，属性" class="headerlink" title="加载类下所有方法，属性"></a>加载类下所有方法，属性</h4><p>使用到 Java 的反射</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Utils</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;com.kuizuo.app.Utils&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> methods = <span class="title class_">Utils</span>.<span class="property">class</span>.<span class="title function_">getDeclaredMethods</span>() <span class="comment">// 方法</span></span><br><span class="line"><span class="keyword">const</span> constructors = <span class="title class_">Utils</span>.<span class="property">class</span>.<span class="title function_">getDeclaredConstructors</span>() <span class="comment">// 构造函数</span></span><br><span class="line"><span class="keyword">const</span> fields = <span class="title class_">Utils</span>.<span class="property">class</span>.<span class="title function_">getDeclaredFields</span>() <span class="comment">// 字段</span></span><br><span class="line"><span class="keyword">const</span> classes = <span class="title class_">Utils</span>.<span class="property">class</span>.<span class="title function_">getDeclaredClasses</span>() <span class="comment">// 内部类</span></span><br><span class="line"><span class="keyword">const</span> superClass = <span class="title class_">Utils</span>.<span class="property">class</span>.<span class="title function_">getSuperclass</span>() <span class="comment">// 父类(抽象类)</span></span><br><span class="line"><span class="keyword">const</span> interfaces = <span class="title class_">Utils</span>.<span class="property">class</span>.<span class="title function_">getInterfaces</span>() <span class="comment">// 所有接口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历输出</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> method <span class="keyword">of</span> methods) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(method.<span class="title function_">getName</span>())</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> class$ <span class="keyword">of</span> classes) &#123;</span><br><span class="line">  <span class="comment">// class$ 为类的字节码，无需.class</span></span><br><span class="line">  <span class="keyword">let</span> fields = <span class="keyword">class</span>$.<span class="title function_">getDeclaredFields</span>()</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> field <span class="keyword">of</span> fields) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(field.<span class="title function_">getName</span>())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数堆栈的打印"><a href="#函数堆栈的打印" class="headerlink" title="函数堆栈的打印"></a>函数堆栈的打印</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">showStack</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;android.util.Log&#x27;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.Throwable&#x27;</span>).$new()))</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HashMap-的打印"><a href="#HashMap-的打印" class="headerlink" title="HashMap 的打印"></a>HashMap 的打印</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">RequestUtil</span>.<span class="property">paraMap</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.util.Map&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="comment">// // a是一个HashMap对象</span></span><br><span class="line">  <span class="keyword">let</span> key = a.<span class="title function_">keySet</span>()</span><br><span class="line">  <span class="keyword">let</span> it = key.<span class="title function_">iterator</span>()</span><br><span class="line">  <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">  <span class="keyword">while</span> (it.<span class="title function_">hasNext</span>()) &#123;</span><br><span class="line">    <span class="keyword">let</span> keystr = it.<span class="title function_">next</span>()</span><br><span class="line">    <span class="keyword">let</span> valuestr = a.<span class="title function_">get</span>(keystr)</span><br><span class="line">    <span class="comment">// keystr 与 valuestr 都是Java的对象，需要使用toString转成文本</span></span><br><span class="line">    <span class="comment">// 直接打印结果为 &lt;instance: java.lang.Object, $className: java.lang.String&gt;</span></span><br><span class="line">    obj[keystr.<span class="title function_">toString</span>()] = valuestr.<span class="title function_">toString</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;obj: &#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj)) <span class="comment">// 将打印成js的对象</span></span><br><span class="line">  <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">paraMap</span>(a)</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="安卓关键代码类"><a href="#安卓关键代码类" class="headerlink" title="安卓关键代码类"></a>安卓关键代码类</h3><table>
<thead>
<tr>
<th>类名</th>
<th>方法</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>android.widget.Toast</td>
<td>show</td>
<td>弹窗提示</td>
</tr>
<tr>
<td>android.widget.EditText</td>
<td>getText</td>
<td>获取编辑框文本</td>
</tr>
<tr>
<td>java.lang.StringBuilder</td>
<td>toString</td>
<td>字符串获取与拼接</td>
</tr>
<tr>
<td>java.lang.String</td>
<td>toString&#x2F;getBytes</td>
<td>获取字符串与字符串字节</td>
</tr>
</tbody></table>
<h3 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h3><p>写文件如果写入的不是私有空间的话，需要获取内部存储空间权限</p>
<p>私有空间 <code>/data/data/包名</code>、<code>/storage/emulated/0/Android/data/包名</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> current_application = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;android.app.ActivityThread&#x27;</span>).<span class="title function_">currentApplication</span>()</span><br><span class="line"><span class="keyword">let</span> context = current_application.<span class="title function_">getApplicationContext</span>()</span><br><span class="line"><span class="keyword">let</span> path = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;android.content.ContextWrapper&#x27;</span>).$new(context).<span class="title function_">getExternalFilesDir</span>(<span class="string">&#x27;Download&#x27;</span>).<span class="title function_">toString</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path) <span class="comment">// 获取app的私有空间 /storage/emulated/0/Android/data/包名/files/Download</span></span><br><span class="line"><span class="keyword">let</span> file = <span class="keyword">new</span> <span class="title class_">File</span>(path + <span class="string">&#x27;/test.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">file.<span class="title function_">write</span>(<span class="string">&#x27;内容&#x27;</span>)</span><br><span class="line">file.<span class="title function_">flush</span>()</span><br><span class="line">file.<span class="title function_">close</span>()</span><br></pre></td></tr></table></figure>

<h3 id="修改类型"><a href="#修改类型" class="headerlink" title="修改类型"></a>修改类型</h3><p>Java.cast</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">utils.<span class="property">shufferMap2</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">map</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;map: &#x27;</span>, map) <span class="comment">// 传入的是HashMap对象，但是会向上转型为Map对象 输出[object Object]</span></span><br><span class="line">  <span class="keyword">var</span> hashMap = <span class="title class_">Java</span>.<span class="title function_">cast</span>(map, <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.util.HashMap&#x27;</span>))</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hashMap: &#x27;</span>, hashMap)</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">shufferMap2</span>(hashMap)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="构建-Java-数组"><a href="#构建-Java-数组" class="headerlink" title="构建 Java 数组"></a>构建 Java 数组</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通字符串数组</span></span><br><span class="line"><span class="keyword">let</span> arr = <span class="title class_">Java</span>.<span class="title function_">array</span>(<span class="string">&#x27;Ljava.lang.String;&#x27;</span>, [<span class="string">&#x27;字符串1&#x27;</span>, <span class="string">&#x27;字符串2&#x27;</span>, <span class="string">&#x27;字符串3&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象数组</span></span><br><span class="line"><span class="keyword">let</span> integer = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.Integer&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> boolean = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.Boolean&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> objarr = <span class="title class_">Java</span>.<span class="title function_">array</span>(<span class="string">&#x27;Ljava.lang.Object;&#x27;</span>, [<span class="string">&#x27;字符串1&#x27;</span>, integer.$new(<span class="number">10</span>), boolean.$new(<span class="literal">true</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment">// arrayList</span></span><br><span class="line"><span class="keyword">var</span> arrayList = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.util.ArrayList&#x27;</span>).$new()</span><br><span class="line"><span class="keyword">var</span> integer = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.Integer&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> boolean = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.Boolean&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Person</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;com.kuizuo.app.Person&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> person = <span class="title class_">Person</span>.$new(<span class="string">&#x27;kuizuo&#x27;</span>, <span class="number">20</span>)</span><br><span class="line">arrayList.<span class="title function_">add</span>(<span class="string">&#x27;kuizuo&#x27;</span>)</span><br><span class="line">arrayList.<span class="title function_">add</span>(integer.$new(<span class="number">10</span>))</span><br><span class="line">arrayList.<span class="title function_">add</span>(boolean.$new(<span class="literal">true</span>))</span><br><span class="line">arrayList.<span class="title function_">add</span>(person)</span><br></pre></td></tr></table></figure>

<p>注: 第一个参数类型给的是<code>Ljava.lang.String;</code> 而不是 <code>[Ljava.lang.String;</code></p>
<h4 id="指定函数下-hook-取消-hook"><a href="#指定函数下-hook-取消-hook" class="headerlink" title="指定函数下 hook(取消 hook)"></a>指定函数下 hook(取消 hook)</h4><p><code>HashMap.put.implementation = null</code> 取消对 HashMap.put 方法的 hook</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HashMap</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.util.HashMap&#x27;</span>)</span><br><span class="line"><span class="title class_">RequestUtil</span>.<span class="property">paraMap</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.util.Map&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="comment">// a是一个HashMap对象</span></span><br><span class="line">  <span class="title class_">HashMap</span>.<span class="property">put</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="comment">// 只在RequestUtil.paraMap方法调用的时候才会打印HashMap传入的参数</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">key</span>: key.<span class="title function_">toString</span>(), <span class="attr">value</span>: value.<span class="title function_">toString</span>() &#125;))</span><br><span class="line">    <span class="keyword">let</span> ret = <span class="variable language_">this</span>.<span class="title function_">put</span>(key, value)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">paraMap</span>(a)</span><br><span class="line">  <span class="title class_">HashMap</span>.<span class="property">put</span>.<span class="property">implementation</span> = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="dex-加载"><a href="#dex-加载" class="headerlink" title="dex 加载"></a>dex 加载</h3><h4 id="注入一个类-registerClass"><a href="#注入一个类-registerClass" class="headerlink" title="注入一个类 registerClass"></a>注入一个类 registerClass</h4><p><a target="_blank" rel="noopener" href="https://frida.re/docs/javascript-api/#java-cast">JavaScript API | Frida • A world-class dynamic instrumentation framework</a></p>
<p>通常是加载某个类，复写某些方法，达到绕过的目的，如证书效验</p>
<p>但此方法相对繁琐，不如直接编写 java 代码编译成 dex 直接注入来的方便，也就有了 dex 的动态加载。</p>
<h4 id="DexClassLoader"><a href="#DexClassLoader" class="headerlink" title="DexClassLoader"></a>DexClassLoader</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// console.log(Java.enumerateLoadedClassesSync().join(&quot;\n&quot;));</span></span><br><span class="line">  <span class="comment">// var dynamic = Java.use(&quot;com.xiaojianbang.app.Dynamic&quot;);</span></span><br><span class="line">  <span class="comment">// console.log(dynamic);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Java.enumerateClassLoaders(&#123;</span></span><br><span class="line">  <span class="comment">//     onMatch: function (loader)&#123;</span></span><br><span class="line">  <span class="comment">//         try &#123;</span></span><br><span class="line">  <span class="comment">//             Java.classFactory.loader = loader;</span></span><br><span class="line">  <span class="comment">//             var dynamic = Java.use(&quot;com.xiaojianbang.app.Dynamic&quot;);</span></span><br><span class="line">  <span class="comment">//             console.log(&quot;dynamic: &quot;, dynamic);</span></span><br><span class="line">  <span class="comment">//             //console.log(dynamic.$new().sayHello());</span></span><br><span class="line">  <span class="comment">//             dynamic.sayHello.implementation = function () &#123;</span></span><br><span class="line">  <span class="comment">//                 console.log(&quot;hook dynamic.sayHello is run!&quot;);</span></span><br><span class="line">  <span class="comment">//                 return &quot;xiaojianbang&quot;;</span></span><br><span class="line">  <span class="comment">//             &#125;</span></span><br><span class="line">  <span class="comment">//         &#125;catch (e) &#123;</span></span><br><span class="line">  <span class="comment">//             console.log(loader);</span></span><br><span class="line">  <span class="comment">//         &#125;</span></span><br><span class="line">  <span class="comment">//     &#125;, onComplete: function () &#123;</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="comment">//     &#125;</span></span><br><span class="line">  <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> dexClassLoader = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;dalvik.system.DexClassLoader&#x27;</span>)</span><br><span class="line">  dexClassLoader.<span class="property">loadClass</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">className</span>) &#123;</span><br><span class="line">    <span class="comment">//console.log(className);</span></span><br><span class="line">    <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">loadClass</span>(className)</span><br><span class="line">    <span class="comment">//console.log(&quot;class: &quot;, result);</span></span><br><span class="line">    <span class="comment">//console.log(&quot;class.class: &quot;, result.class);</span></span><br><span class="line">    <span class="comment">//console.log(&quot;xxxxxxxx: &quot;, result.getDeclaredMethods());</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&#x27;com.xiaojianbang.app.Dynamic&#x27;</span> === className) &#123;</span><br><span class="line">      <span class="title class_">Java</span>.<span class="property">classFactory</span>.<span class="property">loader</span> = <span class="variable language_">this</span></span><br><span class="line">      <span class="keyword">var</span> dynamic = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;com.xiaojianbang.app.Dynamic&#x27;</span>)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;dynamic: &#x27;</span>, dynamic)</span><br><span class="line">      <span class="comment">//var clazz = dynamic.class;</span></span><br><span class="line">      <span class="comment">//console.log(&quot;xxxxxxxx: &quot;, clazz.getDeclaredMethods()[0].invoke(clazz.newInstance(), []));</span></span><br><span class="line">      <span class="comment">//console.log(dynamic.$new().sayHello());</span></span><br><span class="line">      dynamic.<span class="property">sayHello</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;dynamic.sayHello is called&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;xiaojianbang&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(dynamic.$new().<span class="title function_">sayHello</span>())</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="dx"><a href="#dx" class="headerlink" title="dx"></a>dx</h3><p>bat: android\SDK\build-tools\sdk 版本\dx.bat</p>
<p>jar 包: android\SDK\build-tools\sdk 版本\lib\dx.jar</p>
<h4 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dx --dex --output=C:\Users\zeyu\Desktop\com\output.dex C:\Users\zeyu\Desktop\com\*</span><br></pre></td></tr></table></figure>

<p><code>C:\Users\zeyu\Desktop\com\*</code>下存放 java 代码编译后的.class 将其转为 dex 文件，也可指定.class 文件</p>
<p>注: <code>C:\Users\zeyu\Desktop\com\*</code> 绝对路径可能会报错，可使用相对路径。</p>
<h4 id="baksmali-与-smali"><a href="#baksmali-与-smali" class="headerlink" title="baksmali 与 smali"></a>baksmali 与 smali</h4><p>github: <a target="_blank" rel="noopener" href="https://github.com/JesusFreke/smali">JesusFreke&#x2F;smali: smali&#x2F;baksmali (github.com)</a></p>
<p>下载地址: <a target="_blank" rel="noopener" href="https://bitbucket.org/JesusFreke/smali/downloads/">JesusFreke &#x2F; smali &#x2F; Downloads — Bitbucket</a></p>
<p>baksmali 将 dex 编译成 smali</p>
<p>smali 将 smali 编译成 dex</p>
<h5 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h5><p>反编译 dex</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar baksmali-2.5.2.jar d classes.dex <span class="comment"># 将会生成out的文件夹</span></span><br></pre></td></tr></table></figure>

<p>回编译 dex</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar smali-2.5.2.jar a out <span class="comment"># 将会生成out.dex文件</span></span><br></pre></td></tr></table></figure>

<h4 id="apktool"><a href="#apktool" class="headerlink" title="apktool"></a>apktool</h4><p><a target="_blank" rel="noopener" href="https://github.com/iBotPeaches/Apktool">iBotPeaches&#x2F;Apktool: A tool for reverse engineering Android apk files (github.com)</a></p>
<p>安装文档: <a target="_blank" rel="noopener" href="https://ibotpeaches.github.io/Apktool/install/">Apktool - How to Install (ibotpeaches.github.io)</a></p>
<h4 id="apksigner"><a href="#apksigner" class="headerlink" title="apksigner"></a>apksigner</h4><p>jar 包: android\SDK\build-tools\sdk 版本\lib\apksigner.jar</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apksigner sign --ks xxx.jks xxx.apk</span><br><span class="line">Keystore password for signer #1:</span><br><span class="line">#</span><br></pre></td></tr></table></figure>

<h4 id="frida-注入-dex-文件"><a href="#frida-注入-dex-文件" class="headerlink" title="frida 注入 dex 文件"></a>frida 注入 dex 文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Java.openClassFile(&quot;/data/local/tmp/xxx.dex&quot;).load();</span><br><span class="line"></span><br><span class="line">// 就可以在内存中使用加载后的类</span><br></pre></td></tr></table></figure>

<h2 id="脱离-PC-使用-frida"><a href="#脱离-PC-使用-frida" class="headerlink" title="脱离 PC 使用 frida"></a>脱离 PC 使用 frida</h2><h3 id="Termux"><a href="#Termux" class="headerlink" title="Termux"></a>Termux</h3><p>使用 Termux 终端，补齐 python，node 环境，相当于手机端运行电脑端的 frida，本质上与电脑端相同。</p>
<h3 id="frida-inject"><a href="#frida-inject" class="headerlink" title="frida-inject"></a>frida-inject</h3><p>同 fridaserver，下载 frida-inject 移动到手机上，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">adb push C:\Users\kuizuo\Desktop\frida-inject-15.1.14-android-arm64 /data/local/tmp/fiarm64</span><br><span class="line"></span><br><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line">cd data/local/tmp</span><br><span class="line">chmod 777 fiarm64</span><br></pre></td></tr></table></figure>

<h5 id="使用-3"><a href="#使用-3" class="headerlink" title="使用"></a>使用</h5><p>前提，hook 的 js 脚本也移动到 fiarm64 相同路径或指定路径。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./fiarm64 -n 包名 -s 脚本.js</span><br><span class="line">./fiarm64 -p pid -s 脚本.js <span class="comment"># ps -A 可查看pid</span></span><br></pre></td></tr></table></figure>

<p>可以加-e，–eternalize 使其在后台运行。</p>
<h3 id="frida-gadget-so"><a href="#frida-gadget-so" class="headerlink" title="frida-gadget.so"></a>frida-gadget.so</h3><p><strong>免 root 使用 frida</strong>，但需要重打包 app，比较稳定。可通过魔改系统，让系统帮我们注入 so，免去重打包的繁琐</p>
<h5 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h5><p>abd、aapt、jarsigner、apksigner、apktool（这些都需要添加到环境变量中）</p>
<h5 id="使用-4"><a href="#使用-4" class="headerlink" title="使用"></a>使用</h5><p>使用到 objection patchapk 命令，选项如下</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>例子</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>-s xxx.apk</td>
<td>-s xxx.apk</td>
<td>指定 apk 文件</td>
</tr>
<tr>
<td>-a so 版本</td>
<td>-a arm64-v8a</td>
<td>指定安卓 so 版本</td>
</tr>
<tr>
<td>-V frida-gadget 版本号</td>
<td>-V 15.1.14</td>
<td>指定 frida-gadget 版本号，默认最新</td>
</tr>
<tr>
<td>-d, –enable-debug</td>
<td>-d</td>
<td>是否允许调试</td>
</tr>
<tr>
<td>-c, –gadget-config TEXT</td>
<td>-c config.txt</td>
<td>加载<a target="_blank" rel="noopener" href="https://frida.re/docs/gadget/#script">配置</a>方式打包</td>
</tr>
</tbody></table>
<p>frida-gadget 可能会下载失败，去 github 下载<a target="_blank" rel="noopener" href="https://github.com/frida/frida/releases/download/15.1.14/frida-gadget-15.1.14-android-arm64.so.xz">frida-gadget-15.1.14-android-arm64.so.xz</a>，解压后将 gadget 文件更名<code>libfrida-gadget.so</code>为存放到<code>C:\Users\zeyu\.objection\android\arm64-v8a</code></p>
<p>执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objection patchapk -a arm64-v8a -V 15.1.14 -s xxx.apk</span><br></pre></td></tr></table></figure>

<p>将会生成 xxx.objection.apk 文件，卸载原 app（与原 apk 签名不一样，无法覆盖安装），重新安装</p>
<p>重新打开将会进入白屏，正常现象，等待 frida 去连接，相当于 apk 中运行了一个 frida-server。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://kuizuo.cn/">改自-愧怍</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://kuizuo.cn/docs/frida-note">https://kuizuo.cn/docs/frida-note</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://qwd.ai" target="_blank">Zyb'Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Fida/">Fida</a></div><div class="post_share"><div class="social-share" data-image="/img/self.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/06/21/Frida-Python/" title="Frida-Python"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Frida-Python</div></div></a></div><div class="next-post pull-right"><a href="/2023/06/08/%E5%AE%89%E5%8D%93%E4%B8%8B-mount-%E2%80%98-system%E2%80%98-not-in-proc-mounts/" title="安卓下 mount ‘/system‘ not in /proc/mounts"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">安卓下 mount ‘/system‘ not in /proc/mounts</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/06/21/Frida-Python/" title="Frida-Python"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-21</div><div class="title">Frida-Python</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/self.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Nohup</div><div class="author-info__description">这个故事，还没有完结</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ZybAirh" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://blog.csdn.net/A_I_H_L?type=blog" target="_blank" title="Csdn"><i class="fab fa-csdn" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="toc-text">虚拟环境安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#conda-%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="toc-text">conda 创建虚拟环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="toc-text">进入虚拟环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="toc-text">退出虚拟环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83"><span class="toc-text">删除虚拟环境</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida"><span class="toc-text">Frida</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-text">安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC"><span class="toc-text">安装指定版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%89%88%E6%9C%AC%E5%8F%B7%EF%BC%8C%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F"><span class="toc-text">查看版本号，验证是否安装成功</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#frida-%E4%BB%A3%E7%A0%81%E6%8F%90%E7%A4%BA"><span class="toc-text">frida 代码提示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#frida-%E7%89%88%E6%9C%AC%E4%B8%8E-Android-%E7%89%88%E6%9C%AC%E4%B8%8E-Python-%E7%89%88%E6%9C%AC"><span class="toc-text">frida 版本与 Android 版本与 Python 版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fridaserver"><span class="toc-text">fridaserver</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-text">使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida-%E5%91%BD%E4%BB%A4"><span class="toc-text">Frida 命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95-Hook-%E8%84%9A%E6%9C%AC%E6%BC%94%E7%A4%BA"><span class="toc-text">简单 Hook 脚本演示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%B1%BB"><span class="toc-text">获取类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E4%B8%8E%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="toc-text">静态方法与实例方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E8%BD%BD%E6%96%B9%E6%B3%95"><span class="toc-text">重载方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#hook-%E6%89%80%E6%9C%89%E9%87%8D%E8%BD%BD%E6%96%B9%E6%B3%95"><span class="toc-text">hook 所有重载方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-text">构造方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%AF%B9%E8%B1%A1"><span class="toc-text">实例化对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E7%B1%BB%E6%96%B9%E6%B3%95"><span class="toc-text">主动调用类方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="toc-text">静态方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95-%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%AF%B9%E8%B1%A1"><span class="toc-text">实例方法 实例化对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95-%E8%8E%B7%E5%8F%96%E5%B7%B2%E6%9C%89%E5%AF%B9%E8%B1%A1-Java-choose"><span class="toc-text">实例方法 获取已有对象(Java.choose)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E4%B8%8E%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">修改函数参数与返回值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E4%B8%8E%E4%BF%AE%E6%94%B9%E7%B1%BB%E5%AD%97%E6%AE%B5-%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F"><span class="toc-text">获取与修改类字段(成员变量)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%AD%97%E6%AE%B5"><span class="toc-text">静态字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E5%AD%97%E6%AE%B5-%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%AF%B9%E8%B1%A1"><span class="toc-text">实例字段 实例化对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E5%AD%97%E6%AE%B5-%E8%8E%B7%E5%8F%96%E5%B7%B2%E6%9C%89%E5%AF%B9%E8%B1%A1-Java-choose"><span class="toc-text">实例字段 获取已有对象(Java.choose)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E7%B1%BB%E4%B8%8E%E5%8C%BF%E5%90%8D%E7%B1%BB"><span class="toc-text">内部类与匿名类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB"><span class="toc-text">枚举类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E7%B1%BB"><span class="toc-text">获取所有类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E7%B1%BB%E4%B8%8B%E6%89%80%E6%9C%89%E6%96%B9%E6%B3%95%EF%BC%8C%E5%B1%9E%E6%80%A7"><span class="toc-text">加载类下所有方法，属性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%A0%86%E6%A0%88%E7%9A%84%E6%89%93%E5%8D%B0"><span class="toc-text">函数堆栈的打印</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HashMap-%E7%9A%84%E6%89%93%E5%8D%B0"><span class="toc-text">HashMap 的打印</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%8D%93%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E7%B1%BB"><span class="toc-text">安卓关键代码类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-text">写文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%B1%BB%E5%9E%8B"><span class="toc-text">修改类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA-Java-%E6%95%B0%E7%BB%84"><span class="toc-text">构建 Java 数组</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%87%BD%E6%95%B0%E4%B8%8B-hook-%E5%8F%96%E6%B6%88-hook"><span class="toc-text">指定函数下 hook(取消 hook)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dex-%E5%8A%A0%E8%BD%BD"><span class="toc-text">dex 加载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E4%B8%80%E4%B8%AA%E7%B1%BB-registerClass"><span class="toc-text">注入一个类 registerClass</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DexClassLoader"><span class="toc-text">DexClassLoader</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dx"><span class="toc-text">dx</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="toc-text">使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#baksmali-%E4%B8%8E-smali"><span class="toc-text">baksmali 与 smali</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-2"><span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#apktool"><span class="toc-text">apktool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#apksigner"><span class="toc-text">apksigner</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#frida-%E6%B3%A8%E5%85%A5-dex-%E6%96%87%E4%BB%B6"><span class="toc-text">frida 注入 dex 文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%84%B1%E7%A6%BB-PC-%E4%BD%BF%E7%94%A8-frida"><span class="toc-text">脱离 PC 使用 frida</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Termux"><span class="toc-text">Termux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#frida-inject"><span class="toc-text">frida-inject</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-3"><span class="toc-text">使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#frida-gadget-so"><span class="toc-text">frida-gadget.so</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83"><span class="toc-text">环境</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-4"><span class="toc-text">使用</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/18/Linux-%E4%B8%8BClash-%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/" title="Linux 下Clash 科学上网">Linux 下Clash 科学上网</a><time datetime="2023-08-17T16:53:44.000Z" title="发表于 2023-08-18 00:53:44">2023-08-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/19/%E6%9F%90%E6%9F%A5-Token-Xposed-Sekiro-%E5%8D%87%E7%BA%A7%E6%96%B9%E6%A1%88/" title="某查 Token Xposed+Sekiro 升级方案">某查 Token Xposed+Sekiro 升级方案</a><time datetime="2023-07-19T12:13:59.000Z" title="发表于 2023-07-19 20:13:59">2023-07-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/16/%E6%9F%90%E6%9F%90%E6%9F%A5App-%E8%AF%B7%E6%B1%82%E5%A4%B4Authorization-%E9%80%86%E5%90%91/" title="某某查App 请求头Authorization 逆向">某某查App 请求头Authorization 逆向</a><time datetime="2023-07-16T11:38:26.000Z" title="发表于 2023-07-16 19:38:26">2023-07-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/16/Iphone-Mac-%E8%B7%A8%E8%AE%BE%E5%A4%87%E5%A4%8D%E5%88%B6%E7%B2%98%E8%B4%B4%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98/" title="Iphone Mac 跨设备复制粘贴失效问题">Iphone Mac 跨设备复制粘贴失效问题</a><time datetime="2023-07-16T11:03:12.000Z" title="发表于 2023-07-16 19:03:12">2023-07-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/06/Insecure-world-writable-dir-opt-homebrew-bin-in-PATH-mode-040777/" title="Insecure world writable dir /opt/homebrew/bin in PATH, mode 040777">Insecure world writable dir /opt/homebrew/bin in PATH, mode 040777</a><time datetime="2023-07-06T02:30:36.000Z" title="发表于 2023-07-06 10:30:36">2023-07-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 By Nohup</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="8498808288" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>